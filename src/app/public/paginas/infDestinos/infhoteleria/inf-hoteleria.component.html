<div *ngIf="hotel" style="max-width: 800px; margin: 2rem auto; padding: 2rem; border-radius: 12px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); background-color: #fff; font-family: 'Segoe UI', sans-serif;">
  <h2 style="font-size: 2rem; margin-bottom: 1rem; color: #333;">{{ hotel.tipoHabitacion }}</h2>

  <!-- Imagen del hotel (si existe) -->
  <img *ngIf="hotel.imagenUrl"
       [src]="hotel.imagenUrl"
       [alt]="hotel.tipoHabitacion"
       style="width: 100%; max-height: 400px; object-fit: cover; border-radius: 8px; margin-bottom: 1.5rem;" />

  <!-- Información principal del hotel -->
  <div style="margin-bottom: 1.5rem;">
    <p><strong>⭐ Clasificación:</strong> {{ obtenerEstrellas() }} ({{ hotel.estrellas }} estrellas)</p>
    <p><strong>👥 Capacidad máxima:</strong> {{ hotel.maxPersonas }} personas</p>
    <p><strong>🍳 Desayuno incluido:</strong>
      <span [style.color]="incluyeDesayuno() ? '#28a745' : '#dc3545'">
        {{ hotel.incluyeDesayuno }}
      </span>
    </p>
    <p *ngIf="hotel.servicio"><strong>💰 Precio base por noche:</strong> S/. {{ hotel.servicio.precioBase | number:'1.2-2' }}</p>
    <p *ngIf="hotel.servicio?.descripcion"><strong>📝 Descripción:</strong> {{ hotel.servicio.descripcion }}</p>
  </div>

  <!-- Información del servicio -->
  <div style="margin-bottom: 1.5rem;" *ngIf="hotel.servicio">
    <h3 style="font-size: 1.25rem; margin-bottom: 0.5rem; color: #555;">Servicio</h3>
    <p><strong>🏷️ Nombre:</strong> {{ hotel.servicio.nombre }}</p>
    <p *ngIf="hotel.servicio.categoria"><strong>📂 Categoría:</strong> {{ hotel.servicio.categoria }}</p>
    <p *ngIf="hotel.servicio.ubicacion"><strong>📍 Ubicación:</strong> {{ hotel.servicio.ubicacion }}</p>
  </div>

  <!-- Formulario de reserva para usuarios autenticados -->
  <div *ngIf="isAuthenticated && !mostrarFormulario" style="margin-bottom: 2rem; padding: 1.5rem; background-color: #f8f9fa; border-radius: 8px;">
    <h3 style="font-size: 1.25rem; margin-bottom: 1rem; color: #555;">🏨 Realizar Reserva</h3>

    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin-bottom: 1rem;">
      <div>
        <label style="display: block; font-weight: bold; margin-bottom: 0.5rem; color: #555;">👥 Cantidad de Personas:</label>
        <input type="number"
               [(ngModel)]="cantidadPersonas"
               [max]="hotel.maxPersonas"
               min="1"
               (blur)="validarCantidadPersonas()"
               style="width: 100%; padding: 0.5rem; border: 1px solid #ddd; border-radius: 4px;">
      </div>

      <div>
        <label style="display: block; font-weight: bold; margin-bottom: 0.5rem; color: #555;">📅 Fecha de Inicio:</label>
        <input type="date"
               [(ngModel)]="fechaInicio"
               [min]="new Date().toISOString().split('T')[0]"
               style="width: 100%; padding: 0.5rem; border: 1px solid #ddd; border-radius: 4px;">
      </div>

      <div>
        <label style="display: block; font-weight: bold; margin-bottom: 0.5rem; color: #555;">📅 Fecha de Fin:</label>
        <input type="date"
               [(ngModel)]="fechaFin"
               [min]="fechaInicio || new Date().toISOString().split('T')[0]"
               style="width: 100%; padding: 0.5rem; border: 1px solid #ddd; border-radius: 4px;">
      </div>
    </div>

    <div style="margin-bottom: 1rem;">
      <label style="display: block; font-weight: bold; margin-bottom: 0.5rem; color: #555;">💬 Observaciones (opcional):</label>
      <textarea [(ngModel)]="observaciones"
                rows="3"
                placeholder="Comentarios adicionales sobre la reserva..."
                style="width: 100%; padding: 0.5rem; border: 1px solid #ddd; border-radius: 4px; resize: vertical;"></textarea>
    </div>

    <!-- Resumen de precio -->
    <div *ngIf="validarFechas()" style="margin-bottom: 1rem; padding: 1rem; background-color: #e3f2fd; border-radius: 8px; text-align: center;">
      <h4 style="margin: 0 0 0.5rem 0; color: #1976d2;">💰 Resumen de Precio</h4>
      <p style="font-size: 1.2rem; font-weight: bold; color: #1976d2; margin: 0;">
        Total: S/. {{ calcularPrecioTotal() | number:'1.2-2' }}
      </p>
    </div>
  </div>

  <!-- Sección de botón de reserva con lógica condicional -->
  <div style="text-align: center; margin-top: 2rem;" *ngIf="!mostrarFormulario">

    <!-- Si el usuario está autenticado -->
    <div *ngIf="isAuthenticated">
      <button (click)="manejarReserva()"
              [disabled]="!validarFechas()"
              style="padding: 0.75rem 2rem; background-color: #28a745; color: white; border: none; border-radius: 8px; font-size: 1rem; cursor: pointer; transition: background-color 0.3s;"
              [style.background-color]="!validarFechas() ? '#6c757d' : '#28a745'"
              [style.cursor]="!validarFechas() ? 'not-allowed' : 'pointer'">
        {{ validarFechas() ? '🏨 Reservar Habitación' : '⚠️ Complete los datos' }}
      </button>
    </div>

    <!-- Si el usuario NO está autenticado -->
    <div *ngIf="!isAuthenticated" style="padding: 1rem; background-color: #f8f9fa; border-radius: 8px; border: 1px solid #dee2e6;">
      <p style="margin-bottom: 1rem; color: #6c757d;">
        💡 Para realizar una reserva, necesitas iniciar sesión o registrarte
      </p>

      <div style="display: flex; gap: 1rem; justify-content: center; flex-wrap: wrap;">
        <button (click)="manejarReserva()"
                style="padding: 0.75rem 1.5rem; background-color: #007bff; color: white; border: none; border-radius: 8px; cursor: pointer; transition: background-color 0.3s;">
          🔐 Iniciar Sesión para Reservar
        </button>

        <button (click)="irAlRegistro()"
                style="padding: 0.75rem 1.5rem; background-color: #28a745; color: white; border: none; border-radius: 8px; cursor: pointer; transition: background-color 0.3s;">
          📝 Registrarse
        </button>
      </div>
    </div>

  </div>

  <!-- COMPONENTE DE RESERVA - SOLO UNA VEZ CON TODOS LOS EVENTOS -->
  <div *ngIf="mostrarFormulario && isAuthenticated">
    <div style="margin-bottom: 1rem; text-align: center;">
      <button (click)="onVolverAlHotel()"
              style="padding: 0.5rem 1rem; background-color: #6c757d; color: white; border: none; border-radius: 4px; cursor: pointer;">
        ← Volver al Hotel
      </button>
    </div>

    <app-crearreserva
      [hotelData]="hotel"
      [cantidadPersonas]="cantidadPersonas"
      [fechaInicio]="fechaInicio"
      [fechaFin]="fechaFin"
      [observaciones]="observaciones"
      (reservaRealizada)="onReservaExitosa()"
      (cancelarReserva)="onVolverAlHotel()">
    </app-crearreserva>
  </div>

  <!-- Mensaje informativo adicional -->
  <div style="margin-top: 1.5rem; padding: 1rem; background-color: #e3f2fd; border-radius: 8px; border-left: 4px solid #2196f3;">
    <h4 style="margin: 0 0 0.5rem 0; color: #1976d2;">ℹ️ Información importante</h4>
    <ul style="margin: 0; padding-left: 1.2rem; color: #555;">
      <li>El precio mostrado es por noche y puede variar según la temporada</li>
      <li>Las reservas están sujetas a disponibilidad</li>
      <li>Se requiere confirmación para procesar la reserva</li>
      <li>Capacidad máxima: {{ hotel.maxPersonas }} personas por habitación</li>
      <li *ngIf="incluyeDesayuno()">✅ Desayuno incluido en la tarifa</li>
      <li *ngIf="!incluyeDesayuno()">❌ Desayuno no incluido en la tarifa</li>
    </ul>
  </div>

</div>

<!-- Loading state -->
<div *ngIf="!hotel && !mostrarFormulario" style="text-align: center; padding: 2rem;">
  <div style="display: inline-block; width: 40px; height: 40px; border: 4px solid #f3f3f3; border-top: 4px solid #007bff; border-radius: 50%; animation: spin 1s linear infinite; margin-bottom: 1rem;"></div>
  <p style="color: #6c757d;">Cargando información del hotel...</p>
</div>

<!-- Error state -->
<div *ngIf="!hotel && !mostrarFormulario" style="text-align: center; padding: 2rem;">
  <div style="max-width: 400px; margin: 0 auto; padding: 2rem; background-color: #f8d7da; border: 1px solid #f5c6cb; border-radius: 8px; color: #721c24;">
    <h3 style="margin-bottom: 1rem;">❌ Hotel no encontrado</h3>
    <p style="margin-bottom: 1.5rem;">Lo sentimos, no pudimos encontrar la información del hotel solicitado.</p>
    <button (click)="router.navigate(['/hoteles'])"
            style="padding: 0.75rem 1.5rem; background-color: #dc3545; color: white; border: none; border-radius: 8px; cursor: pointer;">
      🏠 Volver a Hoteles
    </button>
  </div>
</div>

<style>
  @keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
  }

  /* Responsive adjustments */
  @media (max-width: 768px) {
    div[style*="grid-template-columns"] {
      grid-template-columns: 1fr !important;
    }

    div[style*="display: flex"] {
      flex-direction: column !important;
    }
  }
</style>
