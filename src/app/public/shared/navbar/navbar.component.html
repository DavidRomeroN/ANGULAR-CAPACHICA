<nav class="navbar navbar-expand-lg fixed-top navbar-transparent" color-on-scroll="500">
  <div class="container">
    <div class="navbar-translate">
      <a class="navbar-brand" href="https://www.creative-tim.com">Contactate con Nosotros</a>
      <button class="navbar-toggler navbar-burger" type="button" data-toggle="collapse" data-target="#navbarToggler" aria-controls="navbarTogglerDemo02" aria-expanded="false" aria-label="Toggle navigation" (click)="sidebarToggle()">
        <span class="navbar-toggler-bar"></span>
        <span class="navbar-toggler-bar"></span>
        <span class="navbar-toggler-bar"></span>
      </button>
    </div>
    <div class="navbar-collapse" id="navbarToggler">
      <ul class="navbar-nav ml-auto">
        <li class="nav-item" *ngIf="!isDocumentation()">
          <a class="nav-link" rel="tooltip" title="Follow us on Twitter" data-placement="bottom" href="https://x.com/PronafcapUPEU" target="_blank">
            <i class="fa fa-twitter"></i>
            <p class="d-lg-none">Twitter</p>
          </a>
        </li>
        <li class="nav-item" *ngIf="!isDocumentation()">
          <a class="nav-link" rel="tooltip" title="Like us on Facebook" data-placement="bottom" href="https://www.facebook.com/upeucampusjuliaca" target="_blank">
            <i class="fa fa-facebook-square"></i>
            <p class="d-lg-none">Facebook</p>
          </a>
        </li>
        <li class="nav-item" *ngIf="!isDocumentation()">
          <a class="nav-link" rel="tooltip" title="Follow us on Instagram" data-placement="bottom" href="https://www.instagram.com/upeucampusjuliaca/" target="_blank">
            <i class="fa fa-instagram"></i>
            <p class="d-lg-none">Instagram</p>
          </a>
        </li>

        <!-- âœ… Botones para usuarios logueados -->
        <div *ngIf="estaLogueado()" style="display: flex; gap: 0.5rem; align-items: center;">
          <!-- BotÃ³n Mis Reservas -->
          <li class="nav-item">
            <button class="btn btn-primary btn-round" (click)="toggleReservas()">
              ğŸ“‹ Mis Reservas
              <span *ngIf="cargandoReservas">...</span>
            </button>
          </li>

          <!-- BotÃ³n Cerrar SesiÃ³n -->
          <li class="nav-item">
            <button class="btn btn-outline-danger btn-round" (click)="cerrarSesion()" title="Cerrar SesiÃ³n">
              ğŸšª Cerrar sesiÃ³n
            </button>
          </li>
        </div>

        <!-- âœ… Botones para usuarios NO logueados -->
        <div *ngIf="!estaLogueado()" style="display: flex; gap: 0.5rem; align-items: center;">
          <li class="nav-item">
            <button class="btn btn-outline-primary btn-round" (click)="irAlLogin()">
              ğŸ” Iniciar SesiÃ³n
            </button>
          </li>
          <li class="nav-item">
            <button class="btn btn-primary btn-round" (click)="irAlRegistro()">
              ğŸ“ Registrarse
            </button>
          </li>
        </div>
      </ul>
    </div>
  </div>

  <!-- âœ… Dropdown mejorado con filtros y informaciÃ³n completa del paquete -->
  <div
    *ngIf="mostrarReservas && estaLogueado()"
    style="
            position: fixed;
            top: 60px;
            right: 20px;
            background: white;
            padding: 1rem;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            width: 420px;
            max-height: 600px;
            overflow: hidden;
            z-index: 1050;
            border: 1px solid #e0e0e0;
        "
    (click)="$event.stopPropagation()"
  >
    <!-- Header con tÃ­tulo y botÃ³n cerrar -->
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem; padding-bottom: 0.5rem; border-bottom: 1px solid #eee;">
      <h5 style="margin: 0; color: #333;">Mis Reservas</h5>
      <button
        (click)="cerrarReservas()"
        style="background: none; border: none; font-size: 18px; cursor: pointer; color: #666; padding: 4px;"
        title="Cerrar"
      >
        âœ•
      </button>
    </div>

    <!-- âœ… Filtros de bÃºsqueda -->
    <div *ngIf="!cargandoReservas && reservas && reservas.length > 0" style="margin-bottom: 1rem; padding: 0.75rem; background: #f8f9fa; border-radius: 8px;">
      <!-- Filtro por texto -->
      <div style="margin-bottom: 0.75rem;">
        <input
          type="text"
          [(ngModel)]="filtroTexto"
          (input)="aplicarFiltros()"
          placeholder="ğŸ” Buscar por tÃ­tulo, descripciÃ³n, localidad..."
          style="
            width: 100%;
            padding: 0.5rem;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 13px;
            box-sizing: border-box;
          "
        />
      </div>

      <!-- Filtro por estado y botÃ³n limpiar -->
      <div style="display: flex; gap: 0.5rem; align-items: center;">
        <select
          [(ngModel)]="filtroEstado"
          (change)="aplicarFiltros()"
          style="
            flex: 1;
            padding: 0.5rem;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 13px;
            background: white;
          "
        >
          <option value="">ğŸ“‹ Todos los estados</option>
          <option *ngFor="let estado of obtenerEstadosUnicos()" [value]="estado">
            {{ obtenerEstadoEspanol(estado) }}
          </option>
        </select>

        <button
          (click)="limpiarFiltros()"
          style="
            padding: 0.5rem 0.75rem;
            background: #6c757d;
            color: white;
            border: none;
            border-radius: 6px;
            font-size: 12px;
            cursor: pointer;
            white-space: nowrap;
          "
          title="Limpiar filtros"
        >
          ğŸ—‘ï¸ Limpiar
        </button>
      </div>

      <!-- Contador de resultados -->
      <div style="margin-top: 0.5rem; font-size: 11px; color: #666; text-align: center;">
        Mostrando {{ reservasFiltradas.length }} de {{ reservas.length }} reservas
      </div>
    </div>

    <!-- âœ… Estado de carga -->
    <div *ngIf="cargandoReservas" style="text-align: center; padding: 2rem;">
      <div style="font-size: 16px; color: #666;">ğŸ”„ Cargando reservas...</div>
    </div>

    <!-- âœ… Lista de reservas filtradas con informaciÃ³n completa del paquete -->
    <div *ngIf="!cargandoReservas && reservasFiltradas && reservasFiltradas.length > 0" style="max-height: 400px; overflow-y: auto; padding-right: 4px;">
      <div *ngFor="let reserva of reservasFiltradas; let i = index" style="margin-bottom: 1rem; padding: 1rem; background: #f8f9fa; border-radius: 10px; border-left: 4px solid #007bff; box-shadow: 0 2px 4px rgba(0,0,0,0.1); position: relative;">

        <!-- Badge de "MÃ¡s reciente" para la primera reserva -->
        <div *ngIf="i === 0" style="position: absolute; top: -8px; right: 8px; background: #28a745; color: white; padding: 2px 8px; border-radius: 10px; font-size: 10px; font-weight: 600;">
          âœ¨ MÃ¡s reciente
        </div>
        <!-- TÃ­tulo del paquete -->
        <div style="margin-bottom: 0.75rem;">
          <h6 style="margin: 0; color: #333; font-weight: 600; font-size: 15px; line-height: 1.3;">
            ğŸ¯ {{ reserva.paqueteTitulo }}
          </h6>
        </div>

        <!-- InformaciÃ³n principal -->
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.5rem; margin-bottom: 0.75rem; font-size: 13px;">
          <div style="display: flex; align-items: center; color: #555;">
            ğŸ“… <strong style="margin-left: 4px;">Inicio:</strong>
            <span style="margin-left: 4px;">{{ formatearFecha(reserva.fechaInicio) }}</span>
          </div>

          <div style="display: flex; align-items: center; color: #555;">
            ğŸ“… <strong style="margin-left: 4px;">Fin:</strong>
            <span style="margin-left: 4px;">{{ formatearFecha(reserva.fechaFin) }}</span>
          </div>

          <div style="display: flex; align-items: center; color: #555;">
            ğŸ‘¥ <strong style="margin-left: 4px;">Personas:</strong>
            <span style="margin-left: 4px;">{{ reserva.cantidadPersonas }}</span>
          </div>

          <div style="display: flex; align-items: center; color: #555;">
            ğŸ’° <strong style="margin-left: 4px;">Precio:</strong>
            <span style="margin-left: 4px;">S/. {{ reserva.paquetePrecio }}</span>
          </div>
        </div>

        <!-- Estado de la reserva -->
        <div style="margin-bottom: 0.5rem;">
          <span
            [style.background-color]="reserva.estado === 'CONFIRMADA' ? '#28a745' : reserva.estado === 'PENDIENTE' ? '#ffc107' : '#dc3545'"
            style="color: white; padding: 0.25rem 0.5rem; border-radius: 12px; font-size: 11px; font-weight: 500;">
            {{ obtenerEstadoEspanol(reserva.estado) }}
          </span>
        </div>

        <!-- InformaciÃ³n adicional del paquete -->
        <div style="display: flex; flex-wrap: wrap; gap: 0.5rem; font-size: 11px; color: #777; margin-bottom: 0.5rem;">
          <span *ngIf="reserva.paqueteDuracion" style="background: #e9ecef; padding: 2px 6px; border-radius: 6px;">
            â±ï¸ {{ reserva.paqueteDuracion }} dÃ­as
          </span>
          <span *ngIf="reserva.paqueteLocalidad" style="background: #e9ecef; padding: 2px 6px; border-radius: 6px;">
            ğŸ“ {{ reserva.paqueteLocalidad }}
          </span>
          <span *ngIf="reserva.paqueteTipoActividad" style="background: #e9ecef; padding: 2px 6px; border-radius: 6px;">
            ğŸª {{ reserva.paqueteTipoActividad }}
          </span>
        </div>

        <!-- Destino si estÃ¡ disponible -->
        <div *ngIf="reserva.destinoNombre" style="font-size: 11px; color: #666; margin-bottom: 0.5rem;">
          ğŸŒ <strong>Destino:</strong> {{ reserva.destinoNombre }}
          <span *ngIf="reserva.destinoUbicacion"> - {{ reserva.destinoUbicacion }}</span>
        </div>

        <!-- DescripciÃ³n breve -->
        <div *ngIf="reserva.paqueteDescripcion" style="font-size: 11px; color: #888; line-height: 1.4; max-height: 40px; overflow: hidden; text-overflow: ellipsis;">
          {{ reserva.paqueteDescripcion }}
        </div>

        <!-- Observaciones si existen -->
        <div *ngIf="reserva.observaciones" style="margin-top: 0.5rem; padding: 0.5rem; background: #fff3cd; border-radius: 6px; font-size: 11px; color: #856404;">
          <strong>ğŸ“ Observaciones:</strong> {{ reserva.observaciones }}
        </div>
      </div>
    </div>

    <!-- âœ… Sin reservas que coincidan con el filtro -->
    <div *ngIf="!cargandoReservas && reservas && reservas.length > 0 && reservasFiltradas.length === 0" style="text-align: center; padding: 2rem; color: #666;">
      <div style="font-size: 48px; margin-bottom: 1rem;">ğŸ”</div>
      <p style="margin: 0; font-size: 14px;">No se encontraron reservas con los filtros aplicados.</p>
      <button
        (click)="limpiarFiltros()"
        style="margin-top: 1rem; padding: 0.5rem 1rem; background: #007bff; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 12px;"
      >
        Mostrar todas las reservas
      </button>
    </div>

    <!-- âœ… Sin reservas en total -->
    <div *ngIf="!cargandoReservas && (!reservas || reservas.length === 0)" style="text-align: center; padding: 2rem; color: #666;">
      <div style="font-size: 48px; margin-bottom: 1rem;">ğŸ“‹</div>
      <p style="margin: 0; font-size: 14px;">No tienes reservas registradas.</p>
      <p style="margin: 0.5rem 0 0 0; font-size: 12px; color: #999;">Â¡Explora nuestros paquetes y haz tu primera reserva!</p>
    </div>
  </div>

  <!-- âœ… Overlay para cerrar al hacer clic fuera -->
  <div
    *ngIf="mostrarReservas"
    style="
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1040;
            background: transparent;
        "
    (click)="cerrarReservas()"
  ></div>

</nav>
